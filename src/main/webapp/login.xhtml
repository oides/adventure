<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/template/main.xhtml">

	<ui:define name="body">

		<div class="container" style="margin-top: 70px;">
			<div class="col-md-6 col-md-offset-3">
				<div class="panel" style="margin-bottom: 0px;">
					<div class="panel-body text-center">
						<button id="google-login" type="button" class="btn btn-danger" style="width: 190px;"><img src="images/google.png"/> <strong>Entrar com Google</strong></button>
					  <button id="facebook-login" type="button" class="btn btn-primary" style="width: 190px;"><img src="images/facebook.png"/> <strong>Entrar com Facebook</strong></button>
					</div>
				</div>
				<p class="seperator">ou</p>
				<div class="panel panel-default">
					<div class="panel-body">
						<form id="form-login" class="form-horizontal" role="form">
							<p>
								<label for="email">E-mail</label>
								<input id="email" type="text" class="form-control input-lg" />
								<div id="email-message" class="label label-danger"></div>
							</p>
							<p>
								<label for="password">Senha</label>
								<input id="password" type="password" class="form-control input-lg" />
								<div id="password-message" class="label label-danger"></div>
							</p>
							<p>
								<button id="login" class="btn btn-lg btn-success " type="button">Entrar</button>
							</p>
							<div id="message" class="label label-danger"></div>
						</form>
					</div>
					<div class="panel-footer text-center">
						<p>
							<a href="register.jsf" class="register-link">Precisa de uma conta? <strong>Registre-se aqui</strong></a> <br /> 
							<a href="recuperar-senha.jsf" class="password-link"><small>Esqueceu sua senha?</small></a>
						</p>
					</div>
				</div>
			</div>
		</div>
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"></div>

		<script src="api/entity/Credentials.js" />

		<h:outputScript name="js/client-plusone.js" />
		<h:outputScript name="js/jquery-1.10.2.js" />
		<h:outputScript name="js/bootstrap.js" />
		<h:outputScript name="js/client/auth.js" />
		<h:outputScript name="js/client/google-auth.js" />

		<script>
			function trataSucesso(response){
				window.location = 'index.html';
			}
	
			function trataErro(response){
				console.log(response.status);

				switch (response.status) {
					case 412: 
						$.each(response.responseJSON, function(index, value) {
							console.log(value.property + ":" + value.message);
							$("#" + value.property + "-message").html(value.message);
						});
						break;

					case 401: 
						$("#message").html("Acesso não autorizado.");
						break;
					case 403:
						$("#message").html("Acesso não permitido.");
						break;
				}
			}

			$(function(){
				$("#login").click(function(){

					$("[id$='message']").html("");
					
					var credentials = new Credentials();
					credentials.email = $("#email").val();
					credentials.password = $("#password").val();

					var client = new AuthClient();
					client.login(credentials, trataSucesso, trataErro);
				});
		
				$(document).keypress(function(e) {
					if(e.which == 13) {
						var credentials = new Credentials();
						credentials.email = $("#email").val();
						credentials.password = $("#password").val();

						var client = new AuthClient();
						client.login(credentials, trataSucesso, trataErro);
					}
				});

				$("#google-login").click(function(){
					$('#myModal').modal('show');
					gapi.auth.signIn({
						'clientid': '611475192580-k33ghah4orsl7d4r1r6qml5i4rtgnnrd.apps.googleusercontent.com',
						'cookiepolicy': 'none',
						'callback': 'onGoogleSignIn',
						'scope': 'https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile' 
					});
				});
			});

			function onGoogleSignIn(authResult) {
				if (authResult['access_token']) {
					console.log(authResult.code);

					var client = new GoogleAuthClient();
					client.login(authResult.code);

				} else if (authResult['error']) {
					console.log("nada!!!");
				}
			}
		</script>
	</ui:define>
</ui:composition>
