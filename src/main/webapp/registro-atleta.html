<!DOCTYPE html>
<html lang='pt-BR'>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
		<title>Adventure | Gerencie seu Evento de Aventura</title>
		<link rel="stylesheet" href="css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="css/datepicker.css" rel="stylesheet">
		<style>
		body {
  		padding-top: 70px;
		}
		.error{
			color: red;
		}
		#choice option { color: black; }
		.empty { color: gray; }
		</style>
	</head>
	<body>
	
    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Adventure</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="registro-atleta.html">Cadastre-se</a></li>
          </ul>
        </div>
      </div>
    </div>
    
		<div class="container">
			<h1>Cadastre-se</h1>
			<form class="form-horizontal" role="form">
					
					<div class="form-group">
						<div class="col-md-6 col-md-offset-3">
							<input type="text" id="nome" class="form-control input-lg" placeholder="Nome" autofocus required>
							<div id="erro-nome" class="label label-danger"></div>
						</div>
						
					</div>
							
					<div class="form-group">
						<div class="col-md-6 col-md-offset-3">
							<input type="email" id="email" class="form-control input-lg" placeholder="E-mail" required>
							<div id="erro-email" class="label label-danger"></div>
						</div>
					</div>
					
					<div class="form-group">
						<div class="col-md-6 col-md-offset-3">
							<input type="password" id="senha" class="form-control input-lg" placeholder="Senha" required>
							<div id="erro-senha" class="label label-danger"></div>
						</div>
					</div>
 
					<div class="form-group">
						<!--
						<div class="col-md-3 col-md-offset-3">
							<div class="input-group input-group-lg date" data-date-format="dd/mm/yyyy">
   							<input type="text" id="nascimento" class="form-control" placeholder="Data de Nascimento" readonly required>
   							<span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
   						</div>
   						<div id="erro-nascimento" class="label label-danger"></div>
						</div>
						-->
						
						<div class="col-md-3 col-md-offset-3">
							<input type="date" id="nascimento" class="form-control input-lg" placeholder="Data de nascimento" required>
							<div id="erro-nascimento" class="label label-danger"></div>
						</div>
					
						<div class="col-md-3">
							<select id="sexo" class="form-control input-lg" required>
								<option value="" selected="selected">Sexo</option>
								<option value="M">Masculino</option>
								<option value="F">Feminino</option>
							</select>
   						<div id="erro-sexo" class="label label-danger"></div>
						</div>			
					</div>
					
					<div class="form-group">
						<div class="col-md-3 col-md-offset-3">
							<input type="button" id="salvar" class="btn btn-primary btn-lg" value="Criar conta"/>
						</div>
					</div>					
			</form>
		</div>
		
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  		<div class="modal-dialog">
    		<div class="modal-content">
      		<div class="modal-header">
        		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      		</div>
      		<div class="modal-body">
        		<p>Cadastro efetuado com sucesso.</p>
      		</div>
    		</div><!-- /.modal-content -->
  		</div><!-- /.modal-dialog -->
		</div>		
		
    <script src="js/jquery-1.10.2.js"></script>
    <script src="js/bootstrap.js"></script>    
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/bootstrap-datepicker.pt-BR.js"></script>
    <script src="js/persistence-service.js"></script>
    <script src="js/model/Usuario.js"></script>
    
    <script>
		function trataSucesso(data){
			$('#myModal').modal('toggle').on('hidden.bs.modal', function () {
				window.location = 'index.html';
			})
		}

		function trataErro(data){
			$.each(data.responseJSON, function( index, value ) {
				$("#erro-" + value.property).html("");
				$("#erro-" + value.property).html(value.message);
				$("#" + value.property).focus();
			});
		}
    
		$(function(){

			$(".input-group.date").datepicker({todayHighlight: true, language: "pt-BR", startView: 2});

			$("#sexo").change(function () {
			    if($(this).val() == "") $(this).addClass("empty");
			    else $(this).removeClass("empty")
			});

			$("#sexo").change();

			$("#email").change(function(){
				var $this = this;
				$.ajax({
					type : "GET",
					url : "api/registro/check",
					data : { property: $this.id, value: $this.value },
					contentType : "application/json;charset=utf8",
					success : function(){
						$("[id|='erro']").html("");
					},
					error : function(respData){
						$("#erro-" + respData.responseJSON[0].property).html("");
						$("#erro-" + respData.responseJSON[0].property).html(respData.responseJSON[0].message);
						$("#" + respData.responseJSON[0].property).focus();
					}
				});
			});

			$("#salvar").click(function(){
				$("[id|='erro']").html("");
				var usuario = new Usuario();
				var persistenceService = new PersistenceService("api");

				usuario.nome = $("#nome").val();
				usuario.senha = $("#senha").val();
				usuario.email = $("#email").val();
				// É preciso testar se o usuário digitou na mão sem o HTML5, não sendo preciso fazer
				// a conversão a baixo e sim apenas setar o valor do campo no objeto
				// usuario.nascimento = $("#nascimento").val().substr(8,2) + '/' + $("#nascimento").val().substr(5,2) + '/' + $("#nascimento").val().substr(0,4);
				usuario.nascimento = $("#nascimento").val();
				
				usuario.sexo = $("#sexo").val();
				persistenceService.create("registro", usuario, trataSucesso, trataErro);
			});
		});
		</script>
	</body>
</html>		