<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/template/main.xhtml">

	<ui:define name="body">
		<div class="container" style="margin-top: 70px;">
			<table id="evento" class="table table-hover footable toggle-circle">
				<thead>
			    <tr>
			      <th width="45%" data-toggle="true">Evento</th>
			      <th width="15%" data-hide="phone">Data</th>
			      <th width="15%" data-hide="phone">Local</th>
			      <th width="15%" data-hide="phone">Modalidades</th>
			      <th width="5%"></th>
			      <th width="5%"></th>
			    </tr>
			  </thead>
			  <tbody></tbody>
			</table>
		</div>

		<h:outputScript name="js/bootstrap.js" />
		<h:outputScript name="js/footable.min.js" />
		<h:outputScript name="js/client/event.js" />
		
		<script>
			//<![CDATA[

			function change(data) {
				var r = data.match(/^\s*([0-9]+)\s*-\s*([0-9]+)\s*-\s*([0-9]+)$/);
				return r[3]+"/"+r[2]+"/"+r[1];
			}
			
			function trataSucesso(data) {
				var footable = $('#evento').footable().data('footable');
				console.log(data);
			
				$.each(data, function(idx, obj) {
					var row = '<tr>';
					$.each(obj, function(key, value) {
						if (key != 'id' && key != 'link') {
							if(key == 'data'){
								value = change(value);
							}
							row += '<td>' + value + '</td>';
						}
					});
					row += '<td><img src="images/orienteering.png" title="Orientação"/> <img src="images/mountainbiking.png" title="Mountain Bike"/></td>';
					row += '<td><button type="button" class="btn btn-sm btn-info">Detalhes</button></td>';
					row += '<td><button type="button" class="btn btn-sm btn-success">Inscrição</button></td>';
					row += '</tr>';
					footable.appendRow(row);
				});
				footable.redraw();
			}
			
			$(function(e) {
				var client = new EventClient();
				client.search(trataSucesso);
			});

			//]]>
		</script>
	</ui:define>
</ui:composition>
