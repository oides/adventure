<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="/template/main.xhtml">

	<ui:define name="body">
		<div class="container">
			<h1>Cadastre-se</h1>
			<form class="form-horizontal" role="form">

				<div class="form-group">
					<div class="col-md-6 col-md-offset-3">
						<input type="text" id="fullName" class="form-control input-lg"
							placeholder="Nome" autofocus="true" required="true" />
						<div id="fullName-message" class="label label-danger"></div>
					</div>
				</div>

				<div class="form-group">
					<div class="col-md-6 col-md-offset-3">
						<input type="email" id="email" class="form-control input-lg"
							placeholder="E-mail" required="true" />
						<div id="email-message" class="label label-danger"></div>
					</div>
				</div>

				<div class="form-group">
					<div class="col-md-6 col-md-offset-3">
						<input type="password" id="password" class="form-control input-lg"
							placeholder="Senha" required="true" />
						<div id="password-message" class="label label-danger"></div>
					</div>
				</div>

				<div class="form-group">
					<!--
						<div class="col-md-3 col-md-offset-3">
							<div class="input-group input-group-lg date" data-date-format="dd/mm/yyyy">
   							<input type="text" id="nascimento" class="form-control" placeholder="Data de Nascimento" readonly required>
   							<span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
   						</div>
   						<div id="erro-nascimento" class="label label-danger"></div>
						</div>
						-->

					<div class="col-md-3 col-md-offset-3">
						<input type="date" id="birthday" class="form-control input-lg"
							placeholder="Data de nascimento" required="true" />
						<div id="birthday-message" class="label label-danger"></div>
					</div>

					<div class="col-md-3">
						<select id="gender" class="form-control input-lg" required="true">
							<option value="" selected="selected">Sexo</option>
							<option value="M">Masculino</option>
							<option value="F">Feminino</option>
						</select>
						<div id="gender-message" class="label label-danger"></div>
					</div>
				</div>

				<div class="form-group">
					<div class="col-md-3 col-md-offset-3">
						<input type="button" id="salvar" class="btn btn-primary btn-lg"
							value="Criar conta" />
					</div>
				</div>
			</form>
		</div>

		<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
			aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"
							aria-hidden="true">xxxxx</button>
					</div>
					<div class="modal-body">
						<p>Cadastro efetuado com sucesso.</p>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>

		<script src="api/entity/User.js"></script>

		<h:outputScript name="js/jquery-1.10.2.js" />
		<h:outputScript name="js/bootstrap.js" />
		<h:outputScript name="js/bootstrap-datepicker.js" />
		<h:outputScript name="js/bootstrap-datepicker.pt-BR.js" />
		<h:outputScript name="js/client/register.js" />

		<script>
		function trataSucesso(data){
			$('#myModal').modal('toggle').on('hidden.bs.modal', function () {
				window.location = 'index.html';
			})
		}

		function trataErro(data){
			$.each(data.responseJSON, function(index, value) {
				$("#" + value.property + "-message").html(value.message);
				$("#" + value.property).focus();
			});
		}
    
		$(function(){

			$(".input-group.date").datepicker({todayHighlight: true, language: "pt-BR", startView: 2});

			$("#sexo").change(function () {
			    if($(this).val() == "") $(this).addClass("empty");
			    else $(this).removeClass("empty")
			});

			$("#sexo").change();

			/*
			$("#email").on("blur change", function(){
				var $this = this;
				$.ajax({
					type : "GET",
					url : "api/registro/check",
					data : { property: $this.id, value: $this.value },
					contentType : "application/json;charset=utf8",
					success : function(){
						$("[id|='erro']").html("");
					},
					error : function(respData){
						$("#erro-" + respData.responseJSON[0].property).html("");
						$("#erro-" + respData.responseJSON[0].property).html(respData.responseJSON[0].message);
						console.log( respData.responseJSON[0].property);
						$("#" + respData.responseJSON[0].property).focus();
					}
				});
			});
			*/

			$("#salvar").click(function(){
				$("[id$='message']").html("");
				var user = new User();
				var client = new RegisterClient("api");

				user.fullName = $("#fullName").val();
				user.password = $("#password").val();
				user.email = $("#email").val();
				// É preciso testar se o usuário digitou na mão sem o HTML5, não sendo preciso fazer
				// a conversão a baixo e sim apenas setar o valor do campo no objeto
				// user.birthday = $("#birthday").val().substr(8,2) + '/' + $("#birthday").val().substr(5,2) + '/' + $("#birthday").val().substr(0,4);
				user.birthday = $("#birthday").val();
				
				user.gender = $("#gender").val();
				client.register(user, trataSucesso, trataErro);
			});
		});
		</script>
	</ui:define>
</ui:composition>